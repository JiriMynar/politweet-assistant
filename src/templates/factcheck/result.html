<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactCheck - Výsledek analýzy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    {% extends "base.html" %}
    
    {% block content %}
    <section class="result-container">
        <div class="result-header">
            <h1>Výsledek analýzy</h1>
            <div class="result-meta">
                <span class="result-date">{{ analysis.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                <span class="result-type">{{ {'standard': 'Standardní', 'quick': 'Rychlá', 'detailed': 'Detailní'}[analysis.analysis_type] }} analýza</span>
            </div>
        </div>
        
        <div class="result-claim-box">
            <h2>Analyzované tvrzení</h2>
            <div class="claim-text">
                <i class="fas fa-quote-left quote-icon"></i>
                <p>{{ analysis.claim_text }}</p>
                <i class="fas fa-quote-right quote-icon"></i>
            </div>
        </div>
        
        <div class="result-verdict-box verdict-{{ analysis.verdict|lower|replace(' ', '-') }}">
            <div class="verdict-header">
                <h2>Verdikt</h2>
                <div class="verdict-confidence">
                    <div class="confidence-meter">
                        <div class="confidence-fill" style="width: {{ analysis.confidence }}%;"></div>
                    </div>
                    <span class="confidence-value">{{ analysis.confidence }}% jistota</span>
                </div>
            </div>
            
            <div class="verdict-content">
                <div class="verdict-icon">
                    {% if analysis.verdict == 'pravdivé' %}
                        <i class="fas fa-check-circle"></i>
                    {% elif analysis.verdict == 'částečně pravdivé' %}
                        <i class="fas fa-adjust"></i>
                    {% elif analysis.verdict == 'nepravdivé' %}
                        <i class="fas fa-times-circle"></i>
                    {% elif analysis.verdict == 'zavádějící' %}
                        <i class="fas fa-exclamation-triangle"></i>
                    {% else %}
                        <i class="fas fa-question-circle"></i>
                    {% endif %}
                </div>
                <div class="verdict-text">
                    <h3>{{ analysis.verdict|title }}</h3>
                </div>
            </div>
        </div>
        
        <div class="result-explanation-box">
            <h2>Vysvětlení</h2>
            <div class="explanation-text">
                <p>{{ analysis.explanation }}</p>
            </div>
        </div>
        
        {% if analysis.evidences %}
        <div class="result-evidence-box">
            <h2>Důkazy</h2>
            <ul class="evidence-list">
                {% for evidence in analysis.evidences %}
                <li class="evidence-item">
                    <i class="fas fa-file-alt"></i>
                    <p>{{ evidence.text }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        {% if analysis.sources %}
        <div class="result-sources-box">
            <h2>Zdroje</h2>
            <ul class="sources-list">
                {% for source in analysis.sources %}
                <li class="source-item">
                    <i class="fas fa-link"></i>
                    <p>{{ source.text }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        {% if analysis.logical_fallacies %}
        <div class="result-fallacies-box">
            <h2>Logické chyby</h2>
            <ul class="fallacies-list">
                {% for fallacy in analysis.logical_fallacies %}
                <li class="fallacy-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>{{ fallacy.text }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        {% if analysis.manipulation_techniques %}
        <div class="result-manipulation-box">
            <h2>Manipulativní techniky</h2>
            <ul class="manipulation-list">
                {% for technique in analysis.manipulation_techniques %}
                <li class="manipulation-item">
                    <i class="fas fa-theater-masks"></i>
                    <p>{{ technique.text }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <div class="result-actions">
            <div class="action-buttons">
                <a href="{{ url_for('factcheck.index') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Nová analýza
                </a>
                <button class="btn btn-primary" id="share-button">
                    <i class="fas fa-share-alt"></i> Sdílet výsledek
                </button>
                {% if session.get('is_supporter') %}
                <button class="btn btn-secondary" id="export-button">
                    <i class="fas fa-file-export"></i> Exportovat
                </button>
                {% endif %}
            </div>
            
            <div class="share-panel" id="share-panel" style="display: none;">
                <h3>Sdílet výsledek</h3>
                <div class="share-options">
                    <button class="share-option" data-platform="facebook">
                        <i class="fab fa-facebook"></i> Facebook
                    </button>
                    <button class="share-option" data-platform="twitter">
                        <i class="fab fa-twitter"></i> Twitter
                    </button>
                    <button class="share-option" data-platform="email">
                        <i class="fas fa-envelope"></i> Email
                    </button>
                    <button class="share-option" data-platform="link">
                        <i class="fas fa-link"></i> Kopírovat odkaz
                    </button>
                </div>
            </div>
            
            {% if session.get('is_supporter') %}
            <div class="export-panel" id="export-panel" style="display: none;">
                <h3>Exportovat výsledek</h3>
                <div class="export-options">
                    <button class="export-option" data-format="pdf">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="export-option" data-format="docx">
                        <i class="fas fa-file-word"></i> Word
                    </button>
                    <button class="export-option" data-format="json">
                        <i class="fas fa-file-code"></i> JSON
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="educational-note">
            <h3><i class="fas fa-graduation-cap"></i> Vzdělávací poznámka</h3>
            <p>Kritické myšlení je klíčové pro rozpoznávání dezinformací. Vždy ověřujte informace z více zdrojů a buďte obezřetní vůči emotivním tvrzením bez důkazů.</p>
            <a href="{{ url_for('education.index') }}" class="btn btn-text">Zjistit více o mediální gramotnosti</a>
        </div>
        
        {% if not session.get('is_supporter') %}
        <div class="support-banner">
            <div class="banner-content">
                <h3>Líbí se vám naše služba?</h3>
                <p>Podpořte náš projekt a získejte přístup k pokročilým funkcím, jako je export výsledků, neomezený počet analýz a prioritní zpracování.</p>
                <a href="{{ url_for('support.index') }}" class="btn btn-primary">Podpořit projekt</a>
            </div>
            <button class="banner-close"><i class="fas fa-times"></i></button>
        </div>
        {% endif %}
    </section>
    {% endblock %}
    
    {% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sdílení výsledku
            const shareButton = document.getElementById('share-button');
            const sharePanel = document.getElementById('share-panel');
            
            if (shareButton && sharePanel) {
                shareButton.addEventListener('click', function() {
                    sharePanel.style.display = sharePanel.style.display === 'none' ? 'block' : 'none';
                    if (exportPanel) exportPanel.style.display = 'none';
                });
                
                const shareOptions = document.querySelectorAll('.share-option');
                shareOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const platform = this.getAttribute('data-platform');
                        const url = window.location.href;
                        const text = 'Výsledek fact-checkingu: {{ analysis.verdict }} - "{{ analysis.claim_text }}"';
                        
                        if (platform === 'facebook') {
                            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
                        } else if (platform === 'twitter') {
                            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
                        } else if (platform === 'email') {
                            window.location.href = `mailto:?subject=${encodeURIComponent('Výsledek fact-checkingu')}&body=${encodeURIComponent(text + '\n\n' + url)}`;
                        } else if (platform === 'link') {
                            navigator.clipboard.writeText(url).then(() => {
                                alert('Odkaz byl zkopírován do schránky!');
                            });
                        }
                    });
                });
            }
            
            // Export výsledku (pouze pro podporovatele)
            const exportButton = document.getElementById('export-button');
            const exportPanel = document.getElementById('export-panel');
            
            if (exportButton && exportPanel) {
                exportButton.addEventListener('click', function() {
                    exportPanel.style.display = exportPanel.style.display === 'none' ? 'block' : 'none';
                    if (sharePanel) sharePanel.style.display = 'none';
                });
                
                const exportOptions = document.querySelectorAll('.export-option');
                exportOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const format = this.getAttribute('data-format');
                        const analysisId = '{{ analysis.id }}';
                        
                        window.location.href = `/factcheck/export/${analysisId}?format=${format}`;
                    });
                });
            }
            
            // Zavření banneru podpory
            const supportBanner = document.querySelector('.support-banner');
            const bannerClose = document.querySelector('.banner-close');
            
            if (supportBanner && bannerClose) {
                bannerClose.addEventListener('click', function() {
                    supportBanner.style.display = 'none';
                    
                    // Uložení preference do localStorage
                    localStorage.setItem('support_banner_closed', 'true');
                });
                
                // Kontrola, zda byl banner již zavřen
                if (localStorage.getItem('support_banner_closed') === 'true') {
                    supportBanner.style.display = 'none';
                }
            }
        });
    </script>
    {% endblock %}
</body>
</html>
